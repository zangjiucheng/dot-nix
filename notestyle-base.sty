% notestyle-base.sty â€” shared requirements & helpers
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{notestyle-base}[2025/09/03 v1.0 Base of NoteStyle]

% Core deps
\RequirePackage{amsfonts,amsmath,amssymb,amsthm}
\RequirePackage{mathtools}
\RequirePackage{xcolor}
\RequirePackage{graphicx}
\RequirePackage{enumitem}
\RequirePackage{framed}
\RequirePackage{changepage}
\RequirePackage{subcaption}
\RequirePackage{setspace}
\RequirePackage{dsfont}
\RequirePackage[ruled,vlined]{algorithm2e}
\RequirePackage{bm}
\RequirePackage{siunitx}
\RequirePackage{cancel}
\RequirePackage{tikz-cd}
\RequirePackage{hyperref}
\RequirePackage{fancyhdr}
\RequirePackage{tikz}
\RequirePackage[most]{tcolorbox}
\RequirePackage{calrsfs}
\RequirePackage{subfiles}
\RequirePackage{multicol}
\RequirePackage{centernot}
\RequirePackage[titles]{tocloft}

% Optional dutchcal (fallback to \mathcal)
\IfFileExists{dutchcal.sty}{\RequirePackage{dutchcal}}{}
\providecommand{\mathdutchcal}{\mathcal}

% Common colors
\definecolor{formalshade}{rgb}{0.95,0.95,1}
\definecolor{darkblue}{rgb}{0,0,0.5}
\definecolor{nslink}{HTML}{0B64C0}   % saturated blue for hyperlinks
\definecolor{nscite}{HTML}{00806E}   % teal accent for citations

% Table of contents compaction
\setlength{\cftparskip}{0pt}
\setlength{\cftbeforesecskip}{0pt}
\setlength{\cftbeforesubsecskip}{0pt}
\setlength{\cftbeforesubsubsecskip}{0pt}

% Set vertical space between paragraphs to a full baseline
\setlength{\parskip}{\baselineskip}

% Bullet-proof: override how tocloft builds the TOC title
\makeatletter
\renewcommand{\tableofcontents}{%
  \newpage
  % Keep PDF bookmark if hyperref is loaded
  \ifdefined\phantomsection\phantomsection\fi
  \@ifundefined{pdfbookmark}{}{%
    \pdfbookmark[1]{\contentsname}{toc}%
  }%
  % Add space on top
  \vspace*{0.05\paperheight}%
  % Heading block
  \begingroup
  \par\nointerlineskip
  \noindent\rule{\linewidth}{0.05pt}\par
  {\hfill\Large\bfseries\sffamily \contentsname\par}%
  \noindent\rule{\linewidth}{0.05pt}\par
  \vspace{\baselineskip}%
  \endgroup
  % Add space below
  \vspace*{0.05\paperheight}%
  % The actual TOC
  \@starttoc{toc}%
}
\makeatother

% Link styling
\hypersetup{
  colorlinks=true,
  linkcolor=nslink,
  urlcolor=nslink,
  citecolor=nscite,
  filecolor=nslink,
  pdfborder={0 0 0}
}

% Line spacing default
\setstretch{1.2}

% Header layout
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\sectionmark}[1]{%
  \markboth{\textit{\uppercase{Chapter \thesection\quad #1}}}{}%
}
\fancyhead[L]{\leftmark}
\fancyhead[R]{\thepage}

% Graphics path (safe even if folder absent)
\graphicspath{{./Images/}}

% Title page layout
\makeatletter
\renewcommand{\maketitle}{%
  \begin{titlepage}
    \thispagestyle{empty}%
    \vspace*{\fill}%
    \begin{center}
      {\LARGE\bfseries\@title\par}%
      \vspace{0.75\baselineskip}%
      {\large\@author\par}%
      {\large\@date\par}%
      \ifx\@empty\@thanks\else
        {\footnotesize\@thanks\par}%
      \fi
    \end{center}
    \vspace*{\fill}%
    \ifx\@empty\@thanks\else
      \begingroup
      \footnotesize\@thanks
      \endgroup
    \fi
  \end{titlepage}
  \setcounter{footnote}{0}%
  \global\let\@title\@empty
  \global\let\@author\@empty
  \global\let\@date\@empty
  \global\let\@thanks\@empty
}
\makeatother

% --- Suppress \maketitle inside included subfiles ---
% Requires: \usepackage{subfiles} in the main document *before* loading this .sty
\makeatletter
\@ifpackageloaded{subfiles}{%
  \@ifundefined{subfile}{}{%
    \let\ns@orig@subfile\subfile
    \renewcommand{\subfile}[1]{%
      \begingroup
      \let\maketitle\relax
      \ns@orig@subfile{#1}%
      \endgroup
    }%
  }%
}{}
\makeatother
